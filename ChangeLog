2006-02-27 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/node_agent.pl: Made remote TCP host and port setable via the
          command line, overriding the config file values.
          
        * eSTAR/NA/Handler.pm: Updated project lookups.
        
        * bin/user_agent.pl: Default nodes now LTproxy and FTNproxy, added
          settings from username and email address to command line.  

2006-02-15 Alasdair Allan <aa@astro.ex.ac.uk>

	* bin/jach_agent.pl: Changed mapping to new project IDs

	* bin/test_templates.pl: Changed to Cc the estar-devel list

	* eSTAR/JAC/Handler.pm: Ignore filters when checking observability

2006-01-20 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/event_broker.pl: Fixed IVORNs

	* bin/event_test.pl: Fixed IVORNs

	* eSTAR/Broker/Util.pm: Fixed IVORNs

2006-01-18 Alasdair Allan <aa@astro.ex.ac.uk>

	* bin/event_broker.pl: Added a pubDate to each feed item.
	
	* eSTAR/Broker/Util.pm: Added an iso_to_rfc822() conversion routine.

2006-01-12 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/event_broker.pl: Major bug fix, although it hard to say what went
          wrong to get the code into the state it was in to cause the bug. Also
          added IAMALIVE echoing to the main, and "other port response" code.
          
2005-12-28 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/event_broker.pl: Some minor bug and logging fixes
        
        * bin/event_test.pl: A test server to emit test messages for the
          event_broker.pl to handle as an incoming event feed.
          
2005-12-26 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/event_broker.pl & eSTAR/Broker/Running.pm: Functioning event
          broker, between thread garbage collection should now work.
          
        * bin/event_client.pl: Simple client which doesn't use too much of
          the eSTAR infrastructure.
            
2005-12-23 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/event_broker.pl: Added server thread to the event broker.
	
2005-12-21 Alasdair Allan <aa@astro.ex.ac.uk>

	* eSTAR/Config.pm: Generalised get_nodes() and get_useragents()
	  to get_block(), left stub routines in for backwards compatibility.
	  
	* bin/event_broker.pl: Started the big job of moving all the
	  functionality of bin/raptor_alert.pl into a generalised event
	  broker. The broker will have a number of client connections, the
	  RAPTOR connection being only one of many, consolidate the feeds
	  and rebroadcast to connected clients.
	
	* etc/event_broker.pl: Added startup script for the event broker.
	  
	* bin/raptor_alert.pl & bin/raptor_gateway.pl: Moved the IAMALIVE
	  functionality back to raptor_gateway.pl as this is ther correct
	  place for it to be, we're testing my connection to RAPTOR to send
	  events rather than the other way round.
	    
2005-12-19 Alasdair Allan <aa@astro.ex.ac.uk>

        * Updated RAPTOR infrastructre to handle the new Astro::VO::VOEvent
          class and other changes to the lower level classes for events.
          
        * bin/raptor_alert.pl: Added IAMALIVE functionality. This initially
          was in bin/raptor_gateway.pl but this was the wrong place to put it
          as the gateway program is a HTN RTML interface. So now all the HTN
          functionality is in the gateway, and the VOEvent functionality is
          in the alerter. Need to pull RTML forwarding out of the alerter and
          into the gateway (gateway needs a continous connection on 43002 as
          well as its current open/close in 5170).

        * Bugfixes to RAPTOR infrastructre
          
2005-11-24 Alasdair Allan <aa@astro.ex.ac.uk>

        * Updated eSTAR::Mail to have a Cc option. Also updated most of the
          infrastructure to use this option. The entire thing needs refactoring
          at some point soon while I can still remember how it works.
          
2005-11-22 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/test_servers.pl: Support code to test server infrastructre
        
        * eSTAR/Config.pm: Added code to support new testing program

2005-11-09 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/raptor_alert.pl: More debugging
        
        * eSTAR/RAPTOR/Util.pm: Fixed store_event() method to autocreate
          directories from the $id of the message.
          
2005-11-08 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/test_templates.pl: Added mail message in case of OMP failure

2005-11-01 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/raptor_alert.pl: Fixed bugs and protocol problems so that it now
          talks to TALON Central correctly.

        * bin/raptor_gateway.pl: Fixed bugs.

        * eSTAR/RAPTOR/Handler.pm: Fixed bugs.

        * eSTAR/RAPTOR/Util.pm: Added store_voevent() method so that proper ACK
          messages can be return to TALON on receipt of a VOEvent message. The
          system now has an Astro::VO::VOEvent dependancy.

2005-10-17 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/test_templates.pl: Script to be run from crontab file so at JAC
          so we don't have any more missed observations. This checks that the
          templates MSBs are valid for the current instrument and have valid
          blank targets in them.

2005-07-23 Alasdair Allan <aa@astro.ex.ac.uk>
        
        * bin/raptor_gateway.pl: Fully working RAPTOR gateway, works for
          observing requests, and for pushing alerts to RAPTOR via the
          handle_voevent() method call.
        
        * bin/raptor_alert.pl: Gateway for incoming alerts from RAPTOR into
          the eSTAR network, seems to be working. Alerts of course currently
          have nowhere to go!
          
2005-07-22 Alasdair Allan <aa@astro.ex.ac.uk>

        * Changes to support running more than one node agent on a machine
          at once. This may have broken many things, hopefully not!
          
        * bin/raptor_gateway.pl: Skeleton for RAPTOR gateway  

2005-07-01 Alasdair Allan <aa@astro.ex.ac.uk> &
           Brad Cavanagh <bradc@jach.hawaii.edu> 

        * bin/interleave_daemon.pl: Added skeleton of the interleave
	  correlation daemon which now queries the DB web service to
	  grab the reference catalogue.
          
2005-07-01 Alasdair Allan <aa@astro.ex.ac.uk>

        * WFCAM/Handler.pm: Added query_db() cone search functionality
	
2005-06-30 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/data_miner.pl: Added data mining server process and associated
	  infrastructure to the wfcam_agent.pl.
	  
	* Changed catalogue shipping between the WFCAM processes to be gzipped
	  and base 64 encoded, this speeds thinsg up a lot. 
	  
	* Changed catalogue shipping between EFCAM processes to use Storable
	  rather the Data::Dumper, this makes things a lot faster again.
	  
	* Initial skeleton seems to work okay...     

2005-06-28 Alasdair Allan <aa@astro.ex.ac.uk>

        * Config/Simple.pm: Added a massively hacked version of Config::Simple
	  to the build. The real Config::Simple proved to be "not thread safe"
	  and I've had to totally reengineer the internals. This was not a
	  pleasant experience.
	  
2005-06-25 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/correlation_daemon.pl: Added SOAP client to push catalogues
	  to the wfcam_agent.pl
	  
	* bin/wfcam_agent.pl: populate_db() method now recieves 'n' serialised
	  Astro::Catalog obejcts. Current serialisation method is using the
	  standard Data::Dumper object. This was a lot harder than it sounds!  

2005-06-03 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/correlation_daemon.pl: Over the course of the last week
	  integrated the new features of Astro::Catlog V4 into the
	  correlation daemon. Time stamped and merged the new and variable
	  object detections to create "proper" catalogue summaries.

2005-06-03 Alasdair Allan <aa@astro.ex.ac.uk> &
           Brad Cavanagh <bradc@jach.hawaii.edu> 

        * bin/correlation_daemon.pl: Removed the Astro::Corlate code and
	  replaced with a mixture of Astro::Correlate and home grown Perl
	  code. While not as sophiticated as the f95 code this will give 
	  us a first cut at the variable star detection in a single waveband.
	  This code will not do multi-colour detection, so if there is a
	  colour term in the variability it will not detect it.
	  
	  Working correlation routine, the correlation_daemon.pl now does
	  full intra-frame correlation, creating a list of variable and 
	  new objects. Still need to merge the initial lists to create a
	  list of "all" objects. For now we can just pass back one of the
	  four/nine frames as this list as we'll need to do further
	  development on Astro::Catalog to allow us to do this...
	  
	* eSTAR/Logging.pm: Added a print_ncr() method.
	    
2005-06-02 Alasdair Allan <aa@astro.ex.ac.uk> 

        * bin/correlation_daemon.pl: Replaced the Astro::Correlate loop with
	  one using Astro::Corlate. Setup is okay, with valid Cluster catalogs
	  being written, but it hangs during the run_corlate() method. Looking
	  at the Astro::Corlate test harness this occurs then as well, although
	  the pure Fortran driver routines work fine. There isn't anything
	  wrong with the Fortran, it looks like there is something wrong with
	  the XS harness or some other thing we're doing inside this routine.
	  
2005-06-02 Alasdair Allan <aa@astro.ex.ac.uk> &
           Brad Cavanagh <bradc@jach.hawaii.edu> 

        * bin/correlation_daemon.pl: Flag file monitoring routines now
          working correctly, inital stab at correlation routines.
	  
	* etc/correlation_daemon.pl: Moved from threaded (or at one stage
	  a forking model) to a one process per camera model with the fork
	  happing from the csh startup script. Monitoring threads 2 - 4 turned
	  off for debugging purposes.
 
2005-06-01 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/correlation_daemon.pl: Stub of the correlation daemon that will
	  be doing the cross-correlation between the intra- and inter-frame
	  comparisons for the WFCAM survey agent.
	  
	* etc/correlation_daemon.csh: Startup script for the above.  
	  
	* bin/wfcam_agent.pl: Updated to use the 3rd generation code base.
	
	* bin/data_miner.pl: Updated to use the 3rd generation code base.
	
	* eSTAR/WFCAM/*.pm: Updated to use the 3rd generation code base.
	
	* eSTAR/Miner/*.pm: Updated to use the 3rd generation code base.
	   
2005-05-10 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/ogle_fetch.pl: Now correctly parses KDH's web pages and retrieves
          a list of targets, then queues thes up with the user_agent using the
          new_observation() method.
          
        * eSTAR/Util.pm: Refactored fudge_message into the utility class along
          with modifications to handle unquoted host name and port number.
          
        * bin/node_agent.pl: Moved fudge_message to Util.pm and modified to
          try and get rid of non-quoted string in IntelligentAgent tag as they
          don't parse using XML::Parser
          
        * eSTAR/NA/Handler.pm: Ditto for the handler class...
        
        * Fixed a bunch of fairly hideous bugs. 
        
        * bin/query_agent.pl: To go along with configure_agent.pl to allow us
          to get back values as well as set them in the agent code while it is
          still running.
          
        * Need to rework the way returned messages are handled bu the UA/Handler
          at the moment this doesn't work very well...      
        
2005-05-09 Aladair Allan <aa@astro.ex.ac.uk>

        * eSTAR/UA/Algorithim/ExoPlanetMonitor.pm: Added, simple copy of
          the SingleExposure algorithim block for now. Need to look into the
          way we generate Automatic followup IDs and how we associate eSTAR
          unique IDs and the OGLE ID. Also need a garbage collection thread
          for the user agent (in a similar fashion to the incomplete one in
          the jach_agent).
          
        * bin/ogle_fetch.pl: Basic script to grab and parse KDH's observing
          priorities web pages.  

2005-05-06 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/node_agent.pl: Fixed buffer overflow error in the TCP/IP server
          of the node agent.
          
        * eSTAR/UA/Handler.pm: Fixed time constraint on teh construction of
          and submission of score and observation request messages  

2005-05-05 Aladair Allan <aa@astro.ex.ac.uk>

        * Working node agent for LT & FTN. Integrated changes to eSTAR::RTML
          to support new RTML tags into the user agent and associated handlers.
          
        * bin/node_agen.pl: Moved to threaded SOAP server from forking version.
        

2005-05-03 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/node_agent.pl: Fixed bugs
        
        * eSTAR/NA/Handler.pm: Fixed bugs and added mapping for user and
          project ID (at least at a very basic hardwired level). This is
          a horrible kludge and needs to be fixed at some point.

2005-04-29 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/node_agent.pl: Added node_agent and supporting modules in
          eSTAR::NA::*. This is a port of the old 2nd generation code base
          used for the prototype discovery nodes and is needed to provide
          an interim SOAP layer for LT, FTN and FTS.
          
2005-03-22 Aladair Allan <aa@astro.ex.ac.uk>

        * Location of the currently deployed instrument held in $INST_TYPE
          environment variable. For UKIRT instrument.xml file is located in
          the $INST_TYPE/ukirt directory.
          
        * JACH/Handler.pm: Added check for instrument type to the template
          handling code.
          
        * eSTAR/JACH/Util.pm: Method to check the XML file containing the
          current instrument.
          
        * GCN/Util.pm: Fixed bug in unpacking negative declination values.
          Need to repack the value into a big endian ordered byte, unpack
          into a little-endian ordered byte and then convert to a signed
          long integer. NB: The convert_to_sextuples() routine will break
          on a big endian machine (such as a Sparc Station).      

2005-02-15 Aladair Allan <aa@astro.ex.ac.uk>

        * Created an eSTAR::Mail class to handle mail messages, modified
          gcn_server.pl and jach_agent.pl to use it. Modified the user_agent.pl
          to do notifications under most circumstances.
          
        * All Handler.pm files: Fixed bad bug in set_option() method which
          meant that we had race conditions on the options files and they
          were getting broken.
          
        * Bad race conditions with the configuration files again, I wish
          I'd never used them, horrible things. Moved User Agent to use the
          ThreadOnAccept.pm module and forced reread() at the start of all
          methods in Handler.pm amongst other things. This seems to cure
          the problems, at least for now.
          
        * Problem wasn't cured. It appears that when I killed the user_agent
          process it left file handles to the options.dat and state.dat files
          open. This meant I was getting "Open file handle detected. If you're
          trying to parse another file, close() it first." errors from the
          Config::Simple module. I'm not sure what was going on really, cured
          this by forcing recreation of the Config::Simple object on reread()
          inside eSTAR::Config. I think this should solve things, it seems
          to have fixed both the race conditions and the flock'ing problem.
          
        * Yuck!
        
        * Added BurstFollowup.pm to be skeleton for processing returned
          observations.  
          
2005-02-14 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/gcn_server.pl: Added email notification of alerts being passed
          to the user agent. Need to move this to the user agent because right
          now obsevration requests that score 0 are still notified.
          
        * bin/jach_agent.pl: Added email notification of alerts being added
          to the UKIRT queue.
          
2005-02-11 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/gcn_server.pl: Modified to trigger on XRT_POS messages rather
          than BAT_POS messages. Now checking soln_status on BAT_POS messages.
          
        * bin/jach_agent.pl: Modified to clean out rejceted messages from the
          state directory. It shouldn't happen, but it appears that sometimes
          they make it in there.
            
2005-02-08 Aladair Allan <aa@astro.ex.ac.uk>

        * Modified UA::Handler and JACH::Handler to deal with the new 
          <Target type="" ident=""></Target> tags generated by the next
          revision of eSTAR::RTML (v1.9.1). We now pass the observation type 
          to the embedded agent via the "ident" attribute rather than the
          "type" attribute. This causes less DTD breakage.
          
2005-02-07 Aladair Allan <aa@astro.ex.ac.uk>


        * bin/gcn_server.pl: Moved TCP/IP server into it's own thread and
          multi-threaded the response on callback. Basic building blocks
          complete, now actually have to write some filtering code.

        * Removed get_reference() from list of routines exported by singleton
          modules such as eSTAR::Process and eSTAR::Config. Should be called
          explicitly anyway using eSTAR::*::get_reference() because several of
          the single instance modules have this method we have namespace 
          clashes if you don't do it that way.
        
        * lib/perl5/GCN/Util.pm: Utility class for gcn_server.pl
        
        * Added .cvsignore files to all directories
        
        * Modified UA::Handler and JACH::Handler to deal with the new 
          <Target type=""></Target> tags generated by eSTAR::RTML. We now
          pass the observation type to the embedded agent so that if it's
          of type InitalBurstFollowup (etc) we can grab the templates
          directly from the OMP rather than parsing flat files.
          
        * lib/perl5/eSTAR/JACH/Handler.pm: Working using the new magic
          words method to retrieve the MSBs directly from the OMP rather
          than parsing flat file templates in the source directories.  
          
2005-02-04 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/gcn_server.pl: Working socket connection to GCN service that
          correctly accepts packets and send an ACK response. Does nothing
          with the packets except log their arrival.

2005-02-02 Aladair Allan <aa@astro.ex.ac.uk>

        * bin/gcn_server.pl: A program to accept incoming GCN packets. Basic
          framework for a server to recieve the GCN packets. It currently will
          recieve the packets correctly, but does not respond with the correct
          ACK message. Possibly something to do with the way I open and close
          the socket?
        
        * lib/perl5/GCN/Constants.pm: Module to manage constants for the
          gcn_server.pl program.

2005-01-19 Alasdair Allan <aa@astro.ex.ac.uk> 
           Tim Jenness <timj@jach.hawaii.edu>

	* bin/jach_agent.pl and associated classes have been updated to
          work with the new JAC infrastructre and with the 3G eSTAR code.
          Code now loopbacks correctly when poked via ORAC-DR test script.

2005-01-11 Alasdair Allan <aa@astro.ex.ac.uk>

        * bin/user_agent.pl: Fulling working 3G user_agent.pl which will 
          talk to the 2G node_agent.pl running on dn2.astro.ex.ac.uk. This 
          user agent should be a lot more robust that the equivalent 2G 
          version as a lot of the nastiest as been refactored out into
          singleton classes.
          
        * bin/jach_agent.pl: Some refactoring, should now work (fully 3G?)
          but doesn't run up due to problems with OMP::SciProg modules.  

2005-01-10 Alasdair Allan <aa@astro.ex.ac.uk>

        * Extensive modifications to move the Config::Simple() backend into
          a singleton object. Modifications to user_agent.pl and to the
          eSTAR::UA::Handler to support the creation of an eSTAR::Config
          singleton class. Also modified eSTAR::Util.
          
          All other agent processes now need modifying to use the same
          code base. The user_agent.pl has been tested sucessfully against
          dn2.astro in SingleExposure mode only running on estar.astro,
          need to install NAG f95 onto estar.astro to test in Followup mode.
        
        * bin/make_observation.pl: Ported from second generation code base
          to help test the user_agent.pl against dn2.astro.
          
2004-12-21 Alasdair Allan <aa@astro.ex.ac.uk>

        * Fixes to get rid of the last $main::* references from the library
          code. All access to main:: resources should now be going through
          single instance objects such as eSTAR::Process and eSTAR::UserAgent
          
2004-11-12 Alasdair Allan <aa@astro.ex.ac.uk>

        * Large number of changes to make the jach_agent.pl code to actually
          work. All ESTAR2_* and ESTAR3_* environment variables have been
          removed, gone back to ESTAR_* variables. We shouldn't need to 
          ever run the old code again and the multiply defined PERL5LIB 
          managed to confuse things enough that I was running some of the
          old code, and some of the new code. This wasn't good, it all seemed 
          to work, but actually didn't.
          
          The only $main::* problem outstanging is the $main::OPT{"http_agent"}
          call in the eSTAR::JACH::Handler, not sure how to approach this at
          the moment. All the %running accesses should now be via the new
          eSTAR::JACH::Running module which stores a reference to the running
          hash created in main() and shared across threads. I think this should
          allow me to lock the internally stored variable in the object without
          having to actually share the object, which I don't think is possible
          yet.
          
        * Removed all reference (hopefully) to JACH__* errors, now using a 
          package wide ESTAR__* error.
          
        * Returned to using the ThreadOnAccept daemon module, we need to share
          the %running hash across threads or it all doesn't work.  
          
2004-11-05 Alasdair Allan <aa@astro.ex.ac.uk>

        * Added some jach_agent.pl code from 2nd generation work, mostly ported
          this code to third generation framework. Problems with the %running
          hash. Need to share the %running hash across threads, and then use
          an eSTAR::Running object to access a reference to this hash perhaps?

2004-02-20 Alasdair Allan <aa@astro.ex.ac.uk>

        * Added freeze(), thaw() and melt() functions for arbitary objects 
	  being serialised to the ~/.estar/$process/state/ directory. 
	  
	* Added set_state() and get_state() functions to allow access to the
	  state.dat file as well as the options.dat file to which access was
	  provided yesterday with the get_option() and set_option() methods.
	  
	* Moved all the options/state querying to eSTAR::Util and put wrapper
	  methods into the Handler classes only.
	  
	* Wrote a datamining_client.pl script which pushes a VOTable file to
	  the data_miner.pl process, along with a host:port to reply to and
	  context ID. This script runs up a "fake" wfcam_agent server for the
	  data_miner.pl to reply to after it has processed the pushed file if
	  a command line switch is given, otherwise you need to have the
	  the data_miner.pl and wfcam_agent.pl running.
	  
	* Added a handle_objects() method to the data_miner.pl, this should  
	  return immediately with an ACK to the client/agent calling it saying
	  that everything is okay, and then return its results in an async
	  manner using threads.
	  
	* Made eSTAR::Util use EXPORT_OK rather than EXPORT and fixed the
	  class method calls (hopefully) to reflect this change.        
	  
	* Added handle_results() method to the wfcam_agent.pl. This will
	  handle results returned by the data_miner.pl.
	    
2004-02-19 Alasdair Allan <aa@astro.ex.ac.uk>

        * Got ping() and echo() working for wfcam_agent.pl. Fixed the breaks
	  in encapsulation present from the 2nd generation code by making 
	  eSTAR::Process and eSTAR::Logging single instance objects.

        * Added a data mining process, carbon copy of the wfcam_agant.pl
	  code with configurations changed. Need to find some way to grab
	  some meta-classes from this so that the 4th generation stuff can
	  actually be easier to write than is currently the case.
	
	* Added a client to generate a VOTable catalogue for a given radius
	  around a given target. Used for deubgging and development of the
	  WFCAM agent and Data Mining Daemon.
	
	* Default options are now generated on first program run only, and
	  the SOAP server has get and set methods exposed to change these.
	      	  
2004-02-18 Alasdair Allan <aa@astro.ex.ac.uk>

        * Inital skeleton installation of the WFCAM survey_agent.pl 
          built. This package is going to be the first 3rd generation
          agent built for the eSTAR project. Initally it should talk
          to the current user_agent.pl and the rest of the 2nd generation
          code, but if Robonet-1.0 goes ahead we'll need to refactor
          the top level User Agent code as it's not robust enough for
          general distribution to astronomers.
          
